<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Описание кода управления системой</title>
</head>
<body>
    <h1>Описание кода управления системой</h1>
    <p>Этот код представляет собой сложную систему управления, которая включает в себя несколько компонентов: сервоприводы, мотор, весовой датчик (HX711), ЖК-дисплей (TFT), инфракрасный приемник и кнопки. Основная цель системы - управление весом объекта и автоматизация действий в зависимости от измеренного веса и других условий. Ниже приведено подробное описание того, как работает эта система:</p>

    <h2>Подключение и настройка оборудования:</h2>
    <ol>
        <li><strong>ЖК-дисплей</strong> (<code>TFT_eSPI tft</code>):
            <ul>
                <li>Подключен к ESP32 для отображения текущего веса, состояния мотора и сервоприводов.</li>
                <li>ЖК-дисплей имеет подсветку, контролируемую через пин <code>LCDpin</code> (пин 15), который настроен как выход.</li>
            </ul>
        </li>
        <li><strong>Весовой датчик</strong> (<code>HX711 scale</code>):
            <ul>
                <li>Подключен к ESP32 через пины <code>dtPin</code> (пин 43) и <code>sckPin</code> (пин 44).</li>
                <li>Используется для измерения веса объекта на платформе.</li>
            </ul>
        </li>
        <li><strong>Сервоприводы</strong> (<code>Servo servo1</code> и <code>Servo servo2</code>):
            <ul>
                <li>Управляют физическими механизмами, которые могут открываться и закрываться.</li>
                <li>Подключены к пинам <code>servo1Pin</code> (пин 2) и <code>servo2Pin</code> (пин 3).</li>
            </ul>
        </li>
        <li><strong>Мотор</strong>:
            <ul>
                <li>Управляется через драйвер мотора (например, L298N), подключенный к пинам <code>bin1Pin</code> (пин 17), <code>pwmbPin</code> (пин 21) и <code>stbyPin</code> (пин 18).</li>
                <li>Мотор может запускаться и останавливаться в зависимости от условий, задаваемых в коде.</li>
            </ul>
        </li>
        <li><strong>Кнопки</strong>:
            <ul>
                <li><code>startButtonPin</code> (пин 11) - кнопка для запуска или остановки работы сервоприводов и мотора.</li>
                <li><code>tareButtonPin</code> (пин 12) - кнопка для обнуления измеренного веса (тарирование).</li>
            </ul>
        </li>
        <li><strong>Инфракрасный приемник</strong> (<code>IRrecv irrecv</code>):
            <ul>
                <li>Подключен к пину <code>IR_RECEIVE_PIN</code> (пин 16) для приема команд с ИК-пульта.</li>
                <li>Используется для дистанционного управления порогом веса.</li>
            </ul>
        </li>
    </ol>

    <h2>Основные функции:</h2>
    <ol>
        <li><code>setup()</code>:
            <ul>
                <li>Настраивает пины, включает инфракрасный приемник и инициализирует весовой датчик.</li>
                <li>Инициализирует ЖК-дисплей и устанавливает его начальные параметры.</li>
                <li>Привязывает сервоприводы к соответствующим пинам.</li>
            </ul>
        </li>
        <li><code>loop()</code>:
            <ul>
                <li>Основной цикл, который постоянно выполняется. Здесь происходит измерение текущего веса, обработка команд от ИК-пульта, проверка состояния кнопок и управление мотором и сервоприводами в зависимости от условий.</li>
                <li><strong>Обработка ИК-сигналов:</strong> Прием и обработка сигналов с ИК-пульта, которые могут изменять порог веса, при достижении которого происходит запуск или остановка мотора.</li>
                <li><strong>Управление мотором:</strong> Мотор запускается, если вес ниже порогового значения, и останавливается, если вес превышает порог.</li>
                <li><strong>Управление сервоприводами:</strong> Если нажата кнопка "старт", сервоприводы открываются и закрываются, после чего запускается мотор.</li>
                <li><strong>Тарирование:</strong> При нажатии кнопки "тара" происходит обнуление показаний весового датчика.</li>
                <li><strong>Вывод информации на ЖК-дисплей:</strong> Обновление данных на экране при изменении веса или других значимых параметров.</li>
            </ul>
        </li>
        <li><code>handleIRInput(unsigned long code)</code>:
            <ul>
                <li>Обработка входящих команд от ИК-пульта. В коде предусмотрены две команды для увеличения и уменьшения порогового значения веса.</li>
            </ul>
        </li>
        <li><code>openServos()</code> и <code>closeServos()</code>:
            <ul>
                <li>Функции для управления сервоприводами. <code>openServos()</code> открывает сервоприводы, <code>closeServos()</code> их закрывает.</li>
            </ul>
        </li>
        <li><code>startMotor()</code> и <code>stopMotor()</code>:
            <ul>
                <li>Функции для управления мотором. <code>startMotor()</code> запускает мотор, <code>stopMotor()</code> его останавливает.</li>
            </ul>
        </li>
        <li><code>tareWeight()</code>:
            <ul>
                <li>Функция для обнуления веса на весовом датчике.</li>
            </ul>
        </li>
        <li><code>displayWeight(float weight, int targetThreshold)</code>:
            <ul>
                <li>Обновляет данные на ЖК-дисплее, отображая текущий вес, пороговое значение, а также состояние сервоприводов и мотора.</li>
            </ul>
        </li>
        <li><code>getSmoothedWeight(float currentWeight)</code>:
            <ul>
                <li>Возвращает усредненное значение веса для сглаживания показаний.</li>
            </ul>
        </li>
    </ol>

    <h2>Итог:</h2>
    <p>Этот код управляет системой, в которой вес объекта измеряется и используется для автоматического управления мотором и сервоприводами. Система также предоставляет возможность ручного и дистанционного управления через кнопки и ИК-пульт, а также отображает информацию о текущем состоянии на ЖК-дисплее.</p>

    Если у вас есть вопросы или предложения, пожалуйста, свяжитесь со мной через <a href="https://t.me/Marselito1">Telegram</a>
</body>
</html>
